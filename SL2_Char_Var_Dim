import snappy 
from multiprocessing import Process, Queue
import time

def _worker(func, args, queue):
    try:
        result = func(*args)
        queue.put(("result", result))
    except Exception as e:
        queue.put(("error", e))


def run_with_timeout(func, *args, timeout):
    queue = Queue()
    process = Process(
        target=_worker,
        args=(func, args, queue)
    )

    process.start()
    process.join(timeout)

    if process.is_alive():
        process.terminate()
        process.join()
        raise TimeoutError(f"Function exceeded {timeout} seconds")

    status, value = queue.get()
    if status == "error":
        raise value
    return value

def SL2_char_var_ideals(name):
    """
    Input:  The name of a manifold from the Hodson Weeks census
    Output: The dimension of the SL2C character variety of the manifold
    """
    M = snappy.Manifold(name)
    G = M.fundamental_group()
    I = G.character_variety_vars_and_polys("as_ideals")
    return I

try:
    result = run_with_timeout(SL2_char_var_ideals, name, timeout=60)
    print(result)
except TimeoutError as e:
    print("Timed out!")


